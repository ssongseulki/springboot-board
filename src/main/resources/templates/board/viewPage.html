<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="fragments/layout">
<th:block layout:fragment="script">
    <script>
        $(document).ready(function () {
            //목록 버튼
            $('#boardListBtn').click(function () {
                location.href = '/boards';
            });

            //수정 버튼
            $('#modifyBtn').click(function () {
                const boardId = $('#boardId').val();
                location.href = '/boards/modifyPage/' + boardId;
            });

            //삭제 버튼
            $('#deleteBtn').click(deleteBoard);

        });

        function deleteBoard() {
            const csrfToken = $("meta[name='_csrf']").attr("content");
            const csrfHeader = $("meta[name='_csrf_header']").attr("content");
            const boardId = $('#boardId').val();

            $.ajax({
                url: '/boards/' + boardId,
                method: 'delete',
                data: boardId,
                contentType: 'application/json; charset=utf-8',
                dataType: 'text',
                beforeSend: function (xhr) {
                    // CSRF 토큰을 요청 헤더에 추가
                    xhr.setRequestHeader(csrfHeader, csrfToken);
                },
                success: function (data) {
                    alert(data);
                    location.href = '/boards';
                },
                error: function (xhr, textStatus, errorThrown) {
                    if (xhr.status === 404) {
                        console.log(xhr.responseText);
                    } else {
                        console.error('오류 발생: ' + textStatus, errorThrown);
                    }
                }
            });
        }

    </script>
</th:block>
<th:block layout:fragment="content">
    <div class="container">
        <div class="boardDiv">
            <table id="table">
                <tr>
                    <td>작성자</td>
                    <td th:text="${board.member.memberName}"></td>
                    <td>작성일</td>
                    <td th:text="${#temporals.format(board.regDate, 'yyyy-MM-dd HH:mm:ss')}"></td>
                </tr>
                <tr>
                    <td>제목</td>
                    <td colspan="3" th:text="${board.title}"></td>
                </tr>
                <tr>
                    <td>첨부파일</td>
                    <td colspan="2"><a th:href="'/boards/downloadFile?fileName=' + ${board.s3fileName}" th:text="${board.fileName}"></a></td>
                    <td><a th:if="${board.filePath != null}" th:href="${board.filePath}">보기</a></td>
                </tr>
                <tr>
                    <td>내용</td>
                    <td colspan="3" th:text="${board.content}"></td>
                </tr>
            </table>
        </div>
        <div>
            <input type="hidden" id="boardId" th:value="${board.id}">
            <input type="button" id="boardListBtn" value="목록">
            <input th:if="${#httpServletRequest.remoteUser == board.member.memberEmail}" type="button" id="modifyBtn"
                   value="수정">
            <input th:if="${#httpServletRequest.remoteUser == board.member.memberEmail}" type="button" id="deleteBtn"
                   value="삭제">
        </div>
    </div>
</th:block>
</html>